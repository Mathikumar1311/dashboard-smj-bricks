<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div class="splash-screen">
        <div class="splash-container">
            <div class="logo-container">
                <div class="logo-box">
                    <i class="fas fa-chart-line logo-icon"></i>
                </div>
            </div>
            <div class="app-info">
                <h1 class="app-name">Business Manager</h1>
                <p class="app-tagline">Professional Management System</p>
            </div>
            <div class="loading-container">
                <div class="loading-progress">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <span class="progress-text">0%</span>
                    </div>
                    <p class="loading-status">Initializing application...</p>
                </div>
            </div>
            <div class="version-info">
                <span>Version 1.0.8</span>
            </div>
        </div>
    </div>

    <!-- Login Section -->
    <section id="loginSection" class="login-section">
        <div class="login-container">
            <div class="login-card">
                <h1 data-lang="login_title"><i class="fas fa-chart-line"></i> Business Dashboard</h1>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label data-lang="username"><i class="fas fa-user"></i> Username</label>
                        <input type="text" id="username" name="username" required autocomplete="username">
                    </div>
                    <!-- In your login section -->
                    <div class="form-group password-group">
                        <label data-lang="password"><i class="fas fa-lock"></i> Password</label>
                        <div class="password-input-container">
                            <input type="password" id="password" name="password" required
                                autocomplete="current-password">
                            <button type="button" class="password-toggle" onclick="PasswordToggle.handleToggle(this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" data-lang="login">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <div id="loginError" class="error-message hidden"></div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboardSection" class="dashboard-section hidden">
        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-left">
                <button id="sidebarToggle" class="sidebar-toggle" title="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 data-lang="dashboard_title"><i class="fas fa-chart-line"></i> Business Dashboard</h1>
            </div>
            <div class="topbar-right">
                <select id="languageSelect" class="language-select" title="Select language">
                    <option value="en">English</option>
                    <option value="ta">தமிழ்</option>
                </select>

                <button id="themeToggle" class="theme-toggle" title="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>

                <!-- Fixed Database Status Indicator -->
                <div id="dbStatus" class="db-status online"
                    title="Connected to cloud database - All systems operational">
                    <i class="fas fa-cloud"></i>
                    <span>Online</span>
                </div>

                <div class="user-info">
                    <img id="userAvatar" class="user-avatar"
                        src="https://ui-avatars.com/api/?name=User&background=ff6b35&color=fff" alt="User Avatar"
                        title="Your profile picture">
                    <span id="userName"></span>
                    <button id="logoutBtn" class="btn-secondary" data-lang="logout" title="Logout from system">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="dashboard-container">
            <!-- Sidebar -->
            <nav id="sidebar" class="sidebar">
                <ul class="nav-menu">
                    <li><a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i> <span data-lang="dashboard">Dashboard</span>
                        </a></li>
                    <li class="admin-only"><a href="#users" class="nav-link" data-section="users">
                            <i class="fas fa-users"></i> <span data-lang="users">Users</span>
                        </a></li>
                    <li class="admin-manager"><a href="#employees" class="nav-link" data-section="employees">
                            <i class="fas fa-user-tie"></i> <span data-lang="employees">Employees</span>
                        </a></li>
                    <li class="admin-manager"><a href="#salary" class="nav-link" data-section="salary">
                            <i class="fas fa-money-bill-wave"></i> <span data-lang="salary">Salary</span>
                        </a></li>
                    <!-- NEW: Attendance Section -->
                    <li class="admin-manager"><a href="#attendance" class="nav-link" data-section="attendance">
                            <i class="fas fa-calendar-check"></i> <span>Attendance</span>
                        </a></li>
                    <li class="admin-manager">
                        <a href="#salary-payments" class="nav-link" data-section="salary-payments">
                            <i class="fas fa-money-check"></i> <span>Salary Payments</span>
                        </a>
                    </li>
                    <li class="admin-supervisor"><a href="#billing" class="nav-link" data-section="billing">
                            <i class="fas fa-file-invoice-dollar"></i> <span data-lang="billing">Billing</span>
                        </a></li>
                    <li class="admin-supervisor"><a href="#customers" class="nav-link" data-section="customers">
                            <i class="fas fa-user-friends"></i> <span data-lang="customers">Customers</span>
                        </a></li>
                    <li class="admin-supervisor"><a href="#pending" class="nav-link" data-section="pending">
                            <i class="fas fa-clock"></i> <span data-lang="pending">Pending</span>
                        </a></li>
                    <li class="admin-supervisor"><a href="#payments" class="nav-link" data-section="payments">
                            <i class="fas fa-credit-card"></i> <span data-lang="payments">Payments</span>
                        </a></li>
                    <li><a href="#reports" class="nav-link" data-section="reports">
                            <i class="fas fa-chart-bar"></i> <span data-lang="reports">Reports</span>
                        </a></li>
                    <li class="settings-item"><a href="#settings" class="nav-link" data-section="settings">
                            <i class="fas fa-cog"></i> <span data-lang="settings">Settings</span>
                        </a></li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Content -->
                <div id="dashboardContent" class="content-section active">
                    <div class="content-header">
                        <h2 data-lang="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                        <div class="online-users">
                            <span data-lang="users_online">Users online:</span>
                            <span id="onlineUsersCount">0</span>
                        </div>
                    </div>
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-wallet"></i></div>
                            <h3 data-lang="total_balance">Total Sales</h3>
                            <p class="card-value" id="totalBalance">₹0</p>
                        </div>
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-percentage"></i></div>
                            <h3 data-lang="gst_amount">GST Amount</h3>
                            <p class="card-value" id="gstAmount">₹0</p>
                        </div>
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                            <h3 data-lang="recent_activity">Total Bills</h3>
                            <p class="card-value" id="recentActivity">0</p>
                        </div>
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-clock"></i></div>
                            <h3 data-lang="pending_payments">Pending Bills</h3>
                            <p class="card-value" id="pendingPayments">0</p>
                        </div>
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-users"></i></div>
                            <h3 data-lang="total_customers">Total Customers</h3>
                            <p class="card-value" id="totalCustomers">0</p>
                        </div>
                        <div class="card">
                            <div class="card-icon"><i class="fas fa-user-tie"></i></div>
                            <h3 data-lang="total_employees">Total Employees</h3>
                            <p class="card-value" id="totalEmployees">0</p>
                        </div>
                    </div>
                </div>

                <!-- Users Content -->
                <div id="usersContent" class="content-section">
                    <div class="content-header">
                        <h2><i class="fas fa-users"></i> User Management</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="userSearch" placeholder="Search users...">
                            </div>
                            <button id="exportUsersBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button id="addUserBtn" class="btn-primary">
                                <i class="fas fa-plus"></i> Add User
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Role</th>
                                    <th>Created Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Employees Content -->
                <div id="employeesContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="employees"><i class="fas fa-user-tie"></i> Employees</h2>
                        <div class="header-actions">
                            <!-- Search Box -->
                            <div class="search-container">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="employeeSearch"
                                        placeholder="Search by ID, name, phone, role..."
                                        data-lang="search_employees_placeholder" />
                                    <button id="clearSearchBtn" class="btn-secondary btn-sm" style="display: none;"
                                        title="Clear search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Family Group Button -->
                            <button id="createFamilyGroupBtn" class="btn-secondary">
                                <i class="fas fa-users"></i> Family Groups
                            </button>

                            <button id="exportEmployeesBtn" class="btn-secondary" data-lang="export">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button id="addEmployeeBtn" class="btn-primary" data-lang="add_employee">
                                <i class="fas fa-plus"></i> Add Employee
                            </button>
                        </div>
                    </div>

                    <!-- Search Results Counter -->
                    <div id="searchResultsCount" class="search-results-count">
                        <!-- Search results count will be displayed here -->
                    </div>

                    <div class="table-container">
                        <table id="employeesTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang="employee_id">Employee ID</th>
                                    <th data-lang="name">Name</th>
                                    <th data-lang="phone">Phone</th>
                                    <th data-lang="type">Type</th>
                                    <th>Status</th>
                                    <th data-lang="role">Role</th>
                                    <th data-lang="join_date">Join Date</th>
                                    <th>Family</th>
                                    <th>Pending Advances</th>
                                    <th data-lang="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <!-- Employees will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="salaryContent" class="section-content">
                    <!-- Quick Actions -->
                    <div id="quickActions"></div>

                    <!-- Summary Cards -->
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="card-icon present">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="card-info">
                                <h3 id="presentTodayCount">0</h3>
                                <p>Present Today</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon absent">
                                <i class="fas fa-user-times"></i>
                            </div>
                            <div class="card-info">
                                <h3 id="absentTodayCount">0</h3>
                                <p>Absent Today</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon total">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="card-info">
                                <h3 id="totalEmployeesCount">0</h3>
                                <p>Total Employees</p>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Grid -->
                    <div class="section-panel">
                        <h3><i class="fas fa-users"></i> Daily Employees</h3>
                        <div id="employeeGrid" class="employee-grid"></div>
                    </div>

                    <!-- Salary Form -->
                    <div class="section-panel">
                        <h3><i class="fas fa-plus-circle"></i> Add Salary/Advance</h3>
                        <form id="salaryForm" class="salary-form">
                            <!-- Form content -->
                        </form>
                    </div>

                    <!-- Salary Records -->
                    <div class="section-panel">
                        <h3><i class="fas fa-history"></i> Recent Records</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Week</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Pending Advances -->
                    <div class="section-panel">
                        <h3><i class="fas fa-clock"></i> Pending Advances</h3>
                        <div id="pendingAdvances" class="advances-grid"></div>
                    </div>
                </div>


                <!-- NEW: Attendance Section -->
                <div id="attendanceContent" class="content-section">
                    <div class="content-header">
                        <h2><i class="fas fa-calendar-check"></i> Attendance Management</h2>
                        <div class="header-actions">
                            <button id="quickAttendanceBtn" class="btn-primary">
                                <i class="fas fa-bolt"></i> Quick Attendance
                            </button>
                            <button id="markAttendanceBtn" class="btn-secondary">
                                <i class="fas fa-plus"></i> Mark Attendance
                            </button>
                            <button id="viewAttendanceReport" class="btn-secondary">
                                <i class="fas fa-chart-bar"></i> Reports
                            </button>
                        </div>
                    </div>

                    <!-- Today's Summary -->
                    <div class="attendance-summary-cards">
                        <div class="summary-card">
                            <div class="summary-icon present">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="summary-content">
                                <div class="summary-label">Present Today</div>
                                <div class="summary-value" id="presentTodayCount">0</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon absent">
                                <i class="fas fa-user-times"></i>
                            </div>
                            <div class="summary-content">
                                <div class="summary-label">Absent Today</div>
                                <div class="summary-value" id="absentTodayCount">0</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon half-day">
                                <i class="fas fa-user-clock"></i>
                            </div>
                            <div class="summary-content">
                                <div class="summary-label">Half Days</div>
                                <div class="summary-value" id="halfDayCount">0</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon total">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="summary-content">
                                <div class="summary-label">Total Employees</div>
                                <div class="summary-value" id="totalEmployeesCount">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Controls -->
                    <div class="attendance-controls-bar">
                        <div class="date-filter">
                            <label for="attendanceDateFilter">Date:</label>
                            <input type="date" id="attendanceDateFilter">
                        </div>
                        <div class="status-filter">
                            <label for="attendanceStatusFilter">Status:</label>
                            <select id="attendanceStatusFilter">
                                <option value="all">All Status</option>
                                <option value="present">Present</option>
                                <option value="absent">Absent</option>
                                <option value="half_day">Half Day</option>
                            </select>
                        </div>
                        <button id="refreshAttendance" class="btn-secondary">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>

                    <!-- Attendance Table -->
                    <div class="table-container">
                        <table id="attendanceTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Employee ID</th>
                                    <th>Employee Name</th>
                                    <th>Status</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Work Hours</th>
                                    <th>Overtime</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="10" class="no-data">
                                        <i class="fas fa-calendar-day"></i>
                                        <br>No attendance records found
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add this to your index.html file in the sections area -->
                <section id="salaryPaymentsContent" class="section-content">
                    <div class="section-header">
                        <h2><i class="fas fa-money-check-alt"></i> Salary Payments</h2>
                        <p>Process employee salary payments and generate payslips</p>
                    </div>

                    <div class="salary-payments-container">
                        <div class="salary-calculation-card">
                            <h3>Salary Calculation & Payment</h3>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="salaryEmployeeSelect">Select Employee *</label>
                                    <select id="salaryEmployeeSelect" class="form-control">
                                        <option value="">Select Employee</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="salaryMonthSelect">Select Month *</label>
                                    <select id="salaryMonthSelect" class="form-control">
                                        <option value="">Select Month</option>
                                    </select>
                                </div>
                            </div>

                            <div class="salary-breakdown">
                                <h4>Salary Breakdown</h4>
                                <div class="breakdown-item">
                                    <span>Basic Salary:</span>
                                    <span id="basicSalaryAmount">₹0.00</span>
                                </div>
                                <div class="breakdown-item positive">
                                    <span>Additions (Bonus, Overtime):</span>
                                    <span id="additionsAmount">₹0.00</span>
                                </div>
                                <div class="breakdown-item negative">
                                    <span>Deductions (Absences, PF, TDS):</span>
                                    <span id="deductionsAmount">₹0.00</span>
                                </div>
                                <div class="breakdown-total">
                                    <span>Net Salary Payable:</span>
                                    <span id="netSalaryAmount">₹0.00</span>
                                </div>
                            </div>

                            <div class="attendance-summary">
                                <p id="attendanceSummary">Select employee and month to calculate salary</p>
                            </div>

                            <div class="action-buttons">
                                <button id="processSalaryBtn" class="btn-primary">
                                    <i class="fas fa-check-circle"></i> Process Salary Payment
                                </button>
                                <button id="generatePayslipBtn" class="btn-secondary">
                                    <i class="fas fa-file-pdf"></i> Generate Payslip
                                </button>
                            </div>
                        </div>

                        <div class="recent-payments-card">
                            <div class="card-header">
                                <h3>Recent Salary Payments</h3>
                                <div class="header-actions">
                                    <button id="viewHistoryBtn" class="btn-outline">
                                        <i class="fas fa-history"></i> View Full History
                                    </button>
                                    <button id="exportPaymentsBtn" class="btn-outline">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>

                            <div id="recentSalaryPayments" class="payments-list">
                                <div class="empty-state">No recent payments found</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Billing Content -->
                <div id="billingContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="billing"><i class="fas fa-file-invoice-dollar"></i> Billing</h2>
                        <button id="addBillBtn" class="btn-primary" data-lang="add_bill">
                            <i class="fas fa-plus"></i> Add Bill
                        </button>
                    </div>
                    <div class="table-container">
                        <div class="table-actions">
                            <button id="exportBillsBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <table id="billsTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang="bill_no">Bill No</th>
                                    <th data-lang="customer">Customer</th>
                                    <th data-lang="amount">Amount</th>
                                    <th data-lang="gst">GST</th>
                                    <th data-lang="date">Date</th>
                                    <th data-lang="status">Status</th>
                                    <th data-lang="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="billsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Customers Content -->
                <div id="customersContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="customers"><i class="fas fa-user-friends"></i> Customers</h2>
                        <button id="addCustomerBtn" class="btn-primary" data-lang="add_customer">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                    <div class="table-container">
                        <div class="table-actions">
                            <button id="exportCustomersBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <table id="customersTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang="name">Name</th>
                                    <th data-lang="phone">Phone</th>
                                    <th data-lang="email">Email</th>
                                    <th data-lang="total_bills">Total Bills</th>
                                    <th data-lang="total_amount">Total Amount</th>
                                    <th data-lang="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Pending Content -->
                <div id="pendingContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="pending"><i class="fas fa-clock"></i> Pending Bills</h2>
                    </div>
                    <div class="table-container">
                        <div class="table-actions">
                            <button id="exportPendingBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <table id="pendingTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang="bill_no">Bill No</th>
                                    <th data-lang="customer">Customer</th>
                                    <th data-lang="amount">Amount</th>
                                    <th data-lang="due_date">Due Date</th>
                                    <th data-lang="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Payments Content -->
                <div id="paymentsContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="payments"><i class="fas fa-credit-card"></i> Payments</h2>
                    </div>
                    <div class="table-container">
                        <div class="table-actions">
                            <button id="exportPaymentsBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <table id="paymentsTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang="payment_id">Payment ID</th>
                                    <th data-lang="bill_no">Bill No</th>
                                    <th data-lang="customer">Customer</th>
                                    <th data-lang="amount">Amount</th>
                                    <th data-lang="date">Date</th>
                                    <th data-lang="method">Method</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="reportsContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="reports"><i class="fas fa-chart-bar"></i> Reports</h2>
                        <div class="report-actions">
                            <button id="exportExcel" class="export-btn">
                                <i class="fas fa-file-excel"></i> Export Excel
                            </button>
                            <button id="exportPdf" class="export-btn pdf">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                            <button id="backupData" class="btn-secondary">
                                <i class="fas fa-database"></i> Backup Data
                            </button>
                        </div>
                    </div>

                    <div class="reports-grid">
                        <div class="report-card">
                            <h3>Sales Report</h3>
                            <div class="report-controls">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Start Date</label>
                                        <input type="date" id="reportStartDate">
                                    </div>
                                    <div class="form-group">
                                        <label>End Date</label>
                                        <input type="date" id="reportEndDate">
                                    </div>
                                </div>
                                <button id="generateReport" class="btn-primary">
                                    <i class="fas fa-chart-bar"></i> Generate Report
                                </button>
                            </div>
                        </div>

                        <div class="report-card">
                            <h3>Quick Statistics</h3>
                            <div id="reportStats" class="report-stats">
                                <!-- Stats will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="reportsTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Bill No</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>GST</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="reportsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Content -->
                <div id="settingsContent" class="content-section">
                    <div class="content-header">
                        <h2 data-lang="settings"><i class="fas fa-cog"></i> Settings</h2>
                    </div>

                    <!-- Navigation tabs will be inserted here by JavaScript -->
                </div>
            </main>
        </div>
    </section>

    <!-- User Modal - UPDATED PASSWORD SECTION -->
    <div id="userModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Add User</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="userForm" class="modal-form">
                <input type="hidden" id="editUserId">

                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="userNameInput" required placeholder="Enter full name">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="userEmail" placeholder="Enter email address">
                </div>

                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="userPhone" placeholder="Enter phone number">
                </div>

                <!-- ✅ ADD THIS PASSWORD SECTION -->
                <div class="form-group">
                    <label>Password *</label>
                    <div class="password-input-container">
                        <input type="password" id="userPassword" required placeholder="Enter password">
                        <button type="button" class="password-toggle" onclick="PasswordToggle.handleToggle(this)">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Confirm Password *</label>
                    <div class="password-input-container">
                        <input type="password" id="userConfirmPassword" required placeholder="Confirm password">
                        <button type="button" class="password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <!-- ✅ END PASSWORD SECTION -->

                <div class="form-group">
                    <label>Role *</label>
                    <select id="userRole" required>
                        <option value="">Select Role</option>
                        <option value="admin">Administrator</option>
                        <option value="manager">Manager</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="user">User</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Status *</label>
                    <select id="userStatus" required>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Save User</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Employee Modal -->
    <div id="employeeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">Add Employee</h3>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <form id="employeeForm" class="modal-form">
                <input type="hidden" id="editEmployeeId">

                <div class="form-group">
                    <label>Employee Type *</label>
                    <div class="form-row" style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                        <label class="radio-label">
                            <input type="radio" name="employeeType" value="employee" checked>
                            <i class="fas fa-user-tie"></i>
                            <span>Employee</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="employeeType" value="driver">
                            <i class="fas fa-truck"></i>
                            <span>Driver</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="employeeName" required placeholder="Enter full name">
                </div>

                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="employeePhone" placeholder="Enter phone number (optional)">
                    <small style="color: #666; font-size: 0.8rem;">Same phone number can be used for multiple
                        employees</small>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="employeeEmail" placeholder="Enter email address (optional)">
                </div>

                <div class="form-group">
                    <label>Role *</label>
                    <input type="text" id="employeeRole" required
                        placeholder="e.g., Manager, Sales Executive, Delivery Driver">
                </div>

                <div class="form-group">
                    <label>Join Date *</label>
                    <input type="date" id="employeeJoinDate" required>
                </div>

                <div class="form-group">
                    <label>Salary Type *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="salaryType" value="daily" checked>
                            <i class="fas fa-calendar-day"></i>
                            <span>Daily</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="salaryType" value="monthly">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Monthly</span>
                        </label>
                    </div>
                </div>

                <div id="vehicleNumberField" class="form-group" style="display: none;">
                    <label>Vehicle Number *</label>
                    <input type="text" id="employeeVehicleNumber" placeholder="e.g., TN01AB1234">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Save Employee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Family Group Modal -->
    <div id="familyGroupModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> Create Family Group</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="familyGroupForm" class="modal-form">
                <div class="form-group">
                    <label>Family Name *</label>
                    <input type="text" id="familyName" required placeholder="Enter family name">
                </div>
                <div class="form-group">
                    <label>Primary Member *</label>
                    <select id="primaryMemberId" required>
                        <option value="">Select Primary Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bank Account Number</label>
                    <input type="text" id="bankAccountNumber" placeholder="Enter account number">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <input type="text" id="bankName" placeholder="Enter bank name">
                    </div>
                    <div class="form-group">
                        <label>IFSC Code</label>
                        <input type="text" id="ifscCode" placeholder="Enter IFSC code">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Create Family Group</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Attendance Modal -->
    <div id="attendanceModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-check"></i> Mark Attendance</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="attendanceForm" class="modal-form">
                <div class="form-group">
                    <label>Employee *</label>
                    <select id="attendanceEmployeeId" required>
                        <option value="">Select Employee</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" id="attendanceDate" required>
                </div>
                <div class="form-group">
                    <label>Status *</label>
                    <select id="attendanceStatus" required>
                        <option value="present">Present</option>
                        <option value="absent">Absent</option>
                        <option value="half_day">Half Day</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Check In Time</label>
                        <input type="time" id="checkInTime">
                    </div>
                    <div class="form-group">
                        <label>Check Out Time</label>
                        <input type="time" id="checkOutTime">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="attendanceNotes" placeholder="Add any notes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Mark Attendance</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Salary Payment Modal -->
    <div id="salaryPaymentModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-money-check"></i> Process Salary Payment</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="salaryPaymentForm" class="modal-form">
                <div class="form-group">
                    <label>Employee *</label>
                    <select id="salaryEmployeeId" required>
                        <option value="">Select Employee</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pay Period Start *</label>
                        <input type="date" id="payPeriodStart" required>
                    </div>
                    <div class="form-group">
                        <label>Pay Period End *</label>
                        <input type="date" id="payPeriodEnd" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Payment Date *</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <div class="form-group">
                    <label>Payment Method *</label>
                    <select id="paymentMethod" required>
                        <option value="cash">Cash</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>
                <div id="salaryPreview" class="salary-preview" style="display: none;">
                    <h4>Salary Preview</h4>
                    <div class="preview-items">
                        <div class="preview-item">
                            <span>Basic Salary:</span>
                            <span id="previewBasicSalary">₹0</span>
                        </div>
                        <div class="preview-item">
                            <span>Overtime:</span>
                            <span id="previewOvertime">₹0</span>
                        </div>
                        <div class="preview-item">
                            <span>Advances Deducted:</span>
                            <span id="previewAdvances">-₹0</span>
                        </div>
                        <div class="preview-item total">
                            <span>Net Salary:</span>
                            <span id="previewNetSalary">₹0</span>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="button" id="calculateSalaryBtn" class="btn-secondary">Calculate</button>
                    <button type="submit" class="btn-primary">Process Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Advance Payment Modal -->
    <div id="advanceModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="advanceModalTitle">Add Advance Payment</h3>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <form id="advanceForm" class="modal-form">
                <input type="hidden" id="advanceEmployeeId">

                <div class="form-group">
                    <label>Employee</label>
                    <input type="text" id="advanceEmployeeName" readonly class="readonly-field">
                </div>

                <div class="form-group">
                    <label>Remaining Allocation</label>
                    <input type="text" id="advanceRemaining" readonly class="readonly-field">
                </div>

                <div class="form-group">
                    <label>Advance Amount (₹) *</label>
                    <input type="number" id="advanceAmount" required min="1" step="0.01"
                        placeholder="Enter advance amount">
                    <small>Maximum: <span id="advanceMaxAmount">₹0</span></small>
                </div>

                <div class="form-group">
                    <label>Payment Date *</label>
                    <input type="date" id="advanceDate" required>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="advanceNotes" placeholder="Add notes about this advance payment"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Add Advance Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div id="employeeDetailsModal" class="modal hidden">
        <!-- This modal will be populated dynamically by JavaScript -->
    </div>

    <!-- Bill Modal -->
    <div id="billModal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="billModalTitle">Add Bill</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="billForm" class="modal-form">
                <input type="hidden" id="editBillId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Bill No *</label>
                        <input type="text" id="billNumber" required readonly>
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="billDate" required>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Customer Details</h4>

                    <div class="form-group">
                        <label>Search Existing Customer</label>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="customerSearch" placeholder="Search by name or phone...">
                        </div>
                        <div id="customerResults" class="customer-results"></div>
                        <small style="color: #666;">Search for existing customers or fill details below for new
                            customer</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Customer Name *</label>
                            <input type="text" id="customerName" required placeholder="Enter customer name">
                        </div>
                        <div class="form-group">
                            <label>Phone *</label>
                            <input type="tel" id="customerPhone" required placeholder="Enter phone number">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="customerEmail" placeholder="Enter email address">
                    </div>
                </div>

                <div class="form-section">
                    <h4>Bill Items</h4>
                    <div id="billItems">
                        <!-- Bill items will be added here dynamically -->
                    </div>
                    <button type="button" id="addItemBtn" class="btn-secondary">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                </div>

                <div class="form-section">
                    <h4>Bill Summary</h4>
                    <div class="bill-summary">
                        <div class="summary-row">
                            <span>Sub Total:</span>
                            <span id="subTotal">₹0.00</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>GST % *</label>
                                <input type="number" id="billGst" value="18" min="0" max="100" required>
                            </div>
                            <div class="form-group">
                                <label>GST Amount</label>
                                <input type="text" id="gstAmountInput" readonly>
                            </div>
                        </div>
                        <div class="summary-row total">
                            <span>Total Amount:</span>
                            <span id="totalAmount">₹0.00</span>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Save Bill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="customerModalTitle">Add Customer</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="customerForm" class="modal-form">
                <input type="hidden" id="editCustomerId">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="customerNameInput" required placeholder="Enter customer name">
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" id="customerPhoneInput" required placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="customerEmailInput" placeholder="Enter email address">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="customerAddress" rows="3" placeholder="Enter customer address"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Save Customer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-download"></i> Export Options</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="export-options">
                <div class="export-option" data-format="excel">
                    <div class="export-icon excel">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <div class="export-info">
                        <h4>Export to Excel</h4>
                        <p>Download as .xlsx file for data analysis</p>
                    </div>
                    <div class="export-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

                <div class="export-option" data-format="pdf">
                    <div class="export-icon pdf">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="export-info">
                        <h4>Export to PDF</h4>
                        <p>Download as .pdf file for reporting</p>
                    </div>
                    <div class="export-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-secondary modal-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden">
        <div class="loading-container">
            <div class="loading-spinner">
                <div class="loading-ring"></div>
                <i class="fas fa-chart-line loader-icon"></i>
            </div>
            <p class="loading-text">Loading...</p>
        </div>
    </div>

    <!-- Export Progress Overlay -->
    <div id="exportProgress" class="modal hidden">
        <div class="modal-content small">
            <div class="modal-header">
                <h3><i class="fas fa-download"></i> Exporting Data</h3>
            </div>
            <div class="export-progress-content">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
                <p class="progress-text">Preparing data...</p>
            </div>
        </div>
    </div>

    <script>
        // Elegant loading animation with better timing
        let progress = 0;
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');
        const loadingStatus = document.querySelector('.loading-status');
        let loadingInterval;

        const loadingSteps = [
            { percent: 15, text: "Loading core modules..." },
            { percent: 35, text: "Initializing database..." },
            { percent: 55, text: "Setting up interface..." },
            { percent: 75, text: "Loading user data..." },
            { percent: 90, text: "Finalizing setup..." },
            { percent: 100, text: "Ready!" }
        ];

        function updateLoadingStatus(currentProgress) {
            const step = loadingSteps.find(s => currentProgress <= s.percent) || loadingSteps[loadingSteps.length - 1];
            if (loadingStatus) {
                loadingStatus.textContent = step.text;
            }
        }

        function safeUpdateProgress() {
            if (progressFill && progressFill.style) {
                progressFill.style.width = `${progress}%`;
            }
            if (progressText && progressText.textContent !== undefined) {
                progressText.textContent = `${Math.round(progress)}%`;
            }
            updateLoadingStatus(progress);
        }

        function startLoadingAnimation() {
            if (!progressFill || !progressText || !loadingStatus) {
                console.warn('Progress elements not found');
                return;
            }

            loadingInterval = setInterval(() => {
                progress += Math.random() * 8 + 4; // Slower, more elegant progress
                if (progress > 100) {
                    progress = 100;
                    clearInterval(loadingInterval);

                    // Add completion class
                    document.querySelector('.loading-progress').classList.add('loading-complete');

                    // Smooth fade out
                    setTimeout(() => {
                        const splashScreen = document.querySelector('.splash-screen');
                        if (splashScreen) {
                            splashScreen.style.opacity = '0';
                            splashScreen.style.transition = 'opacity 0.8s ease';
                            setTimeout(() => {
                                splashScreen.style.display = 'none';
                            }, 800);
                        }
                    }, 1000);
                }
                safeUpdateProgress();
            }, 250);
        }

        // Start loading animation safely
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startLoadingAnimation);
        } else {
            startLoadingAnimation();
        }
    </script>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/lang.js"></script>
    <script src="js/db.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/user-manager.js"></script>
    <script src="js/employee-manager.js"></script>
    <script src="js/attendance-manager.js"></script>
    <script src="js/salary-manager.js"></script>
    <script src="js/billing-manager.js"></script>
    <script src="js/customer-manager.js"></script>
    <script src="js/reports-manager.js"></script>
    <script src="js/export-manager.js"></script>
    <script src="js/settings-manager.js"></script>
    <script src="js/app.js"></script>
</body>

</html>